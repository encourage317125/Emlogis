<?xml version="1.0" encoding="UTF-8"?>

<plannerBenchmark>
  <benchmarkDirectory>data/benchmarker/outputs</benchmarkDirectory>
  <!--<parallelBenchmarkCount>AUTO</parallelBenchmarkCount>-->
  <warmUpSecondsSpentLimit>30</warmUpSecondsSpentLimit>
  <inheritedSolverBenchmark>
    <problemBenchmarks>
      <solutionFileIOClass>com.emlogis.engine.drools.benchmarker.EmployeeScheduleFileIO</solutionFileIOClass>
      <inputSolutionFile>data/benchmarker/inputs/OPE-42.json</inputSolutionFile>
      <problemStatisticType>BEST_SCORE</problemStatisticType>
      <problemStatisticType>CALCULATE_COUNT_PER_SECOND</problemStatisticType>
      <problemStatisticType>MOVE_COUNT_PER_STEP</problemStatisticType>
	  <singleStatisticType>CONSTRAINT_MATCH_TOTAL_BEST_SCORE</singleStatisticType>
    </problemBenchmarks>
   
    <solver>
		<solutionClass>com.emlogis.engine.domain.EmployeeSchedule</solutionClass>
  	 	<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
      <scoreDirectorFactory>
        <scoreDefinitionClass>com.emlogis.engine.solver.drools.score.QualificationScoreDefinition</scoreDefinitionClass>
       	<scoreDrl>com/emlogis/engine/solver/rules/constraints/UtilityRules.drl</scoreDrl>
        <scoreDrl>com/emlogis/engine/solver/rules/constraints/HardConstraintRules.drl</scoreDrl>
        <scoreDrl>com/emlogis/engine/solver/rules/scoring/ScheduleScoringRules.drl</scoreDrl>
      </scoreDirectorFactory>
      <termination>
        <minutesSpentLimit>30</minutesSpentLimit>
      </termination>
    </solver>
  </inheritedSolverBenchmark>
  
  <solverBenchmark>
    <name>StepHillClimbing300-TABU10percent-SwapPillar-ActiveSkillsAndTeams_ChangeAndSwapMoves-ShiftAssignmentSorted</name>
    <solver>
    	<constructionHeuristic>
     	  <queuedEntityPlacer>
			<entitySelector id="placerEntitySelector">
				<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedFilter</filterClass>
				<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
				<cacheType>PHASE</cacheType>
				<selectionOrder>SORTED</selectionOrder>
      			<sorterManner>DECREASING_DIFFICULTY</sorterManner>
			</entitySelector>
			<changeMoveSelector>
				<entitySelector mimicSelectorRef="placerEntitySelector"/>
 				<filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeHasSkillFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsOnTeamFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentFilter</filterClass>
				<valueSelector>
					<cacheType>PHASE</cacheType>
				</valueSelector>
			</changeMoveSelector>
		</queuedEntityPlacer>
		<forager>
      		<pickEarlyType>FIRST_NON_DETERIORATING_SCORE</pickEarlyType>
   		 </forager>
       </constructionHeuristic>
       <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>20</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeHasSkillFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsOnTeamFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedFilter</filterClass>
                    <cacheType>JUST_IN_TIME</cacheType>
                </entitySelector>
            </changeMoveSelector>
            <swapMoveSelector>
            	<filterClass>com.emlogis.engine.domain.solver.filters.EmployeeHasSkillSwapFilter</filterClass>
            	<filterClass>com.emlogis.engine.domain.solver.filters.EmployeeOnTeamSwapFilter</filterClass>
				<entitySelector>
					<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
					<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedFilter</filterClass>
					<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
				</entitySelector>
            </swapMoveSelector>
            <pillarChangeMoveSelector>
	            <pillarSelector>
					<entitySelector>
						<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
						<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedFilter</filterClass>
						<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
					</entitySelector>
				</pillarSelector>
            </pillarChangeMoveSelector>
            <pillarSwapMoveSelector>
	            <pillarSelector>
					<entitySelector>
						<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
						<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedFilter</filterClass>
						<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
					</entitySelector>
				</pillarSelector>
            </pillarSwapMoveSelector>
            
        </unionMoveSelector>
        <acceptor>
             <stepCountingHillClimbingSize>300</stepCountingHillClimbingSize>
             <entityTabuRatio>0.10</entityTabuRatio>
        </acceptor>
        <forager>
			<pickEarlyType>FIRST_BEST_SCORE_IMPROVING</pickEarlyType>
            <acceptedCountLimit>4</acceptedCountLimit>
        </forager>
    </localSearch>
     <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>10</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
			    <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeHasSkillFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsOnTeamFilter</filterClass>	               
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.OnlyExcessShiftFilter</filterClass>
                	<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
                </entitySelector>
            </changeMoveSelector>
        </unionMoveSelector>
        <acceptor>
            <entityTabuRatio>0.10</entityTabuRatio>
        </acceptor>
        <forager>
            <acceptedCountLimit>700</acceptedCountLimit>
            <pickEarlyType>FIRST_BEST_SCORE_IMPROVING</pickEarlyType>
        </forager>
    </localSearch>
    </solver>
  </solverBenchmark>
  
</plannerBenchmark>
