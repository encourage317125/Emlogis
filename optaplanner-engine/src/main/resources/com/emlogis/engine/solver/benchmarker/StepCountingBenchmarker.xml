<?xml version="1.0" encoding="UTF-8"?>

<plannerBenchmark>
  <benchmarkDirectory>data/benchmarker/outputs</benchmarkDirectory>
  <!--<parallelBenchmarkCount>AUTO</parallelBenchmarkCount>-->
  <warmUpSecondsSpentLimit>30</warmUpSecondsSpentLimit>
  <inheritedSolverBenchmark>
    <problemBenchmarks>
      <solutionFileIOClass>com.emlogis.engine.drools.benchmarker.EmployeeScheduleFileIO</solutionFileIOClass>
      <inputSolutionFile>data/benchmarker/inputs/Feb1-90Shifts.json</inputSolutionFile>
      <inputSolutionFile>data/benchmarker/inputs/Feb15-160Shifts.json</inputSolutionFile>
      <problemStatisticType>BEST_SCORE</problemStatisticType>
      <problemStatisticType>CALCULATE_COUNT_PER_SECOND</problemStatisticType>
    </problemBenchmarks>
   
    <solver>
		<solutionClass>com.emlogis.engine.domain.EmployeeSchedule</solutionClass>
  	 	<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
      <scoreDirectorFactory>
        <scoreDefinitionClass>com.emlogis.engine.solver.drools.score.QualificationScoreDefinition</scoreDefinitionClass>
        <scoreDrl>com/emlogis/engine/solver/HardConstraintRules.drl</scoreDrl>
        <scoreDrl>com/emlogis/engine/solver/ScheduleScoringRules.drl</scoreDrl>
        <initializingScoreTrend>ONLY_DOWN</initializingScoreTrend>
      </scoreDirectorFactory>
      <termination>
        <secondsSpentLimit>120</secondsSpentLimit>
      </termination>
      <constructionHeuristic>
     	  <queuedEntityPlacer>
			<entitySelector id="placerEntitySelector">
				<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
				<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
				<cacheType>PHASE</cacheType>
			</entitySelector>
			<changeMoveSelector>
				<entitySelector mimicSelectorRef="placerEntitySelector"/>
				<filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveSelectionFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentSelectionFilter</filterClass>
				<valueSelector>
					<cacheType>PHASE</cacheType>
				</valueSelector>
			</changeMoveSelector>
		</queuedEntityPlacer>
      </constructionHeuristic>
    </solver>
  </inheritedSolverBenchmark>
  
 
  	<#list [100, 300, 600] as stepHillSize>
	<#list [10] as acceptedCountLimit>
  <solverBenchmark>
    <name>StepHillClimbing${stepHillSize}-CountLimit${acceptedCountLimit}</name>
    <solver>
       <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>30</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveSelectionFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentSelectionFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
                    <cacheType>JUST_IN_TIME</cacheType>
                </entitySelector>
            </changeMoveSelector>
            <swapMoveSelector>
				<entitySelector>
					<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
					<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
					<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
				</entitySelector>
            </swapMoveSelector>
            <pillarChangeMoveSelector>
	            <pillarSelector>
					<entitySelector>
						<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
						<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
						<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
					</entitySelector>
				</pillarSelector>
            </pillarChangeMoveSelector>
        </unionMoveSelector>
        <acceptor>
             <stepCountingHillClimbingSize>${stepHillSize}</stepCountingHillClimbingSize>
        </acceptor>
        <forager>
            <acceptedCountLimit>${acceptedCountLimit}</acceptedCountLimit>
        </forager>
    </localSearch>
     <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>30</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
	                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveSelectionFilter</filterClass>
	                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentSelectionFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.OnlyExcessShiftFilter</filterClass>
                	<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
                </entitySelector>
            </changeMoveSelector>
        </unionMoveSelector>
        <acceptor>
            <entityTabuRatio>0.10</entityTabuRatio>
        </acceptor>
        <forager>
            <acceptedCountLimit>700</acceptedCountLimit>
            <pickEarlyType>FIRST_BEST_SCORE_IMPROVING</pickEarlyType>
        </forager>
    </localSearch>
    </solver>
  </solverBenchmark>
  </#list>
  </#list>
  
  <#list [100, 300, 600] as stepHillSize>
  <#list [4] as acceptedCountLimit>
  <solverBenchmark>
    <name>StepHillClimbing${stepHillSize}-CountLimit${acceptedCountLimit}Tabu10Percent</name>
    <solver>
       <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>30</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveSelectionFilter</filterClass>
                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentSelectionFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
                	<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
                    <cacheType>JUST_IN_TIME</cacheType>
                </entitySelector>
            </changeMoveSelector>
            <swapMoveSelector>
				<entitySelector>
					<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
					<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
					<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
				</entitySelector>
            </swapMoveSelector>
            <pillarChangeMoveSelector>
	            <pillarSelector>
					<entitySelector>
						<filterClass>com.emlogis.engine.domain.solver.filters.ExcessShiftFilter</filterClass>
						<filterClass>com.emlogis.engine.domain.solver.filters.ShiftAssignmentLockedSelectionFilter</filterClass>
						<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
					</entitySelector>
				</pillarSelector>
            </pillarChangeMoveSelector>
        </unionMoveSelector>
        <acceptor>
             <stepCountingHillClimbingSize>${stepHillSize}</stepCountingHillClimbingSize>
             <entityTabuRatio>0.10</entityTabuRatio>
        </acceptor>
        <forager>
            <acceptedCountLimit>${acceptedCountLimit}</acceptedCountLimit>
        </forager>
    </localSearch>
     <localSearch>
        <termination>
            <unimprovedSecondsSpentLimit>30</unimprovedSecondsSpentLimit>
        </termination>
        <unionMoveSelector>
            <changeMoveSelector>
	                <filterClass>com.emlogis.engine.domain.solver.filters.EmployeeIsActiveSelectionFilter</filterClass>
	                <filterClass>com.emlogis.engine.domain.solver.filters.MovableShiftAssignmentSelectionFilter</filterClass>
                <valueSelector/>
                <entitySelector>
                	<filterClass>com.emlogis.engine.domain.solver.filters.OnlyExcessShiftFilter</filterClass>
                	<entityClass>com.emlogis.engine.domain.ShiftAssignment</entityClass>
                </entitySelector>
            </changeMoveSelector>
        </unionMoveSelector>
        <acceptor>
            <entityTabuRatio>0.10</entityTabuRatio>
        </acceptor>
        <forager>
            <acceptedCountLimit>700</acceptedCountLimit>
            <pickEarlyType>FIRST_BEST_SCORE_IMPROVING</pickEarlyType>
        </forager>
    </localSearch>
    </solver>
  </solverBenchmark>
  </#list>
  </#list>
  
</plannerBenchmark>